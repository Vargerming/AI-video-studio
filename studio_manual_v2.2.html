<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<title>Мануал-Библия v2.2 — Studio (полная версия с портами, скриптами и уведомлениями)</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
:root{--accent:#0b3b5b;--muted:#666;}
body{font-family:Inter, Arial, sans-serif;margin:18px;color:#111;background:#f7f9fb;}
h1{color:var(--accent);}
section{background:#fff;border:1px solid #e6e9ee;padding:14px;border-radius:8px;margin-bottom:12px;}
.node{padding:10px;border-radius:6px;background:linear-gradient(#fff,#fbfcff);border:1px solid #eef3f8;margin-top:8px;}
.kbd{background:#f4f6fa;padding:2px 6px;border-radius:4px;font-family:monospace;}
.small{color:var(--muted);}
table{border-collapse:collapse;width:100%}
th,td{border:1px solid #e6e9ee;padding:6px;text-align:left}
</style>
</head>
<body>
<h1>Мануал-Библия v2.2 — Полная версия</h1>
<p class="small">Добавлены: детальная SVG-схема с портами и моделями, шаблоны email-уведомлений и автоматические отчёты, готовые скрипты (systemd/.sh, .bat) в zip-архиве.</p>

<section id="diagram">
  <h2>Детальная схема портов и устройств (кликабельная)</h2>
  <p class="small">Ниже — схематичное изображение с типичными портами и примерами моделей. Нажмите на блок, чтобы перейти к разделу инструкции.</p>
  <div style="background:#fff;padding:12px;border-radius:8px;border:1px solid #e6eef5;">
    <!-- Detailed SVG with port labels and example models -->
    <svg width="100%" height="480" viewBox="0 0 1200 480" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Studio port diagram">
      <style>
        .box{fill:#f9fbff;stroke:#cfe7ff;rx:8;}
        .title{font-weight:700;fill:#0b3b5b;}
        .muted{fill:#345;}
        .port{font-size:12px;fill:#0b3b5b;}
      </style>
      <!-- Laptop -->
      <rect x="40" y="30" width="300" height="120" rx="8" fill="#fffef7" stroke="#ffebc8"/>
      <text x="190" y="50" text-anchor="middle" class="title">Laptop (Windows) — Dell XPS / Lenovo ThinkPad</text>
      <text x="190" y="70" text-anchor="middle" class="muted">Ports: USB-A, USB-C / TB3, HDMI, Ethernet (RJ45)</text>
      <text x="100" y="100" class="port">USB-A → Audio Interface (focusrite)</text>
      <text x="190" y="100" class="port">HDMI → Capture (Elgato HD60)</text>
      <text x="280" y="100" class="port">Ethernet → 1Gb/s</text>

      <!-- Capture -->
      <rect x="380" y="20" width="220" height="140" rx="8" fill="#f7fcff" stroke="#d7eeff"/>
      <a href="#laptop"><text x="490" y="50" text-anchor="middle" class="title">Capture Device</text></a>
      <text x="490" y="72" text-anchor="middle" class="muted">Elgato HD60 / Blackmagic Intensity</text>
      <text x="430" y="100" class="port">Input: HDMI / SDI</text>
      <text x="540" y="100" class="port">Output: USB 3.0 (UVC)</text>

      <!-- Local GPU Node -->
      <rect x="640" y="20" width="320" height="140" rx="8" fill="#f7fff7" stroke="#d7f5d7"/>
      <text x="800" y="50" text-anchor="middle" class="title">Local GPU Node — Custom PC (Nvidia RTX 3070)</text>
      <text x="800" y="72" text-anchor="middle" class="muted">Ports: PCIe, NVMe, USB, Ethernet</text>
      <text x="720" y="100" class="port">PCIe → GPU (RTX) for NVENC</text>
      <text x="880" y="100" class="port">NVMe → scratch recording</text>

      <!-- NAS -->
      <rect x="980" y="30" width="200" height="120" rx="8" fill="#f0f8ff" stroke="#d7ecff"/>
      <text x="1080" y="60" text-anchor="middle" class="title">NAS / Storage — Synology / QNAP</text>
      <text x="1080" y="82" text-anchor="middle" class="muted">GigE, SMB/NFS, RAID</text>
      <text x="1080" y="106" class="port">Storage: SSD/HDD, backup targets</text>

      <!-- Rented CPU/GPU -->
      <rect x="140" y="220" width="300" height="180" rx="8" fill="#fff8ff" stroke="#f2d7f2"/>
      <text x="290" y="250" class="title">Rented CPU Node — cloud VM (Ubuntu)</text>
      <text x="290" y="272" class="muted">SSH, ffmpeg, whisper</text>
      <text x="220" y="300" class="port">Ports: SSH (22), SFTP/rsync</text>

      <rect x="480" y="220" width="300" height="180" rx="8" fill="#fff8ff" stroke="#f2d7f2"/>
      <text x="630" y="250" class="title">Rented GPU Node — cloud GPU (AWS/GCP/Azure)</text>
      <text x="630" y="272" class="muted">CUDA, NVENC, nvidia-smi</text>
      <text x="560" y="300" class="port">Ports: SSH, S3/rsync endpoints</text>

      <!-- Arrows -->
      <defs><marker id="arr" markerWidth="10" markerHeight="10" refX="6" refY="5" orient="auto"><path d="M0,0 L10,5 L0,10 z" fill="#0b3b5b"/></marker></defs>
      <line x1="340" y1="90" x2="380" y2="90" stroke="#0b3b5b" stroke-width="2" marker-end="url(#arr)"/>
      <line x1="560" y1="90" x2="640" y2="90" stroke="#0b3b5b" stroke-width="2" marker-end="url(#arr)"/>
      <line x1="960" y1="90" x2="980" y2="90" stroke="#0b3b5b" stroke-width="2" marker-end="url(#arr)"/>
      <line x1="200" y1="220" x2="200" y2="200" stroke="#2b6fb3" stroke-dasharray="6,4" stroke-width="2" marker-end="url(#arr)"/>
      <line x1="640" y1="220" x2="640" y2="160" stroke="#b34a6b" stroke-width="2" marker-end="url(#arr)"/>
    </svg>
  </div>
  <p class="small">Модели указаны как примеры — можно заменить под твой инвентарь.</p>
</section>

<section id="scripts">
  <h2>Готовые скрипты и сервисы (в архиве)</h2>
  <div class="node">
    <p class="small">Я подготовил zip-архив со скриптами: systemd unit, encode-watcher.sh, backup-recordings.sh, Windows .bat (backup-recordings.bat), health-checks. Скачать ниже:</p>
    <p><a href="./studio_scripts_v2.2.zip" download>Скачать ZIP с готовыми скриптами</a></p>
  </div>

  <div class="node">
    <h3>Что внутри архива (коротко)</h3>
    <table>
      <thead><tr><th>Файл</th><th>Назначение</th></tr></thead>
      <tbody>
        <tr><td>systemd/studio-encode.service</td><td>systemd unit для Linux CPU watcher</td></tr>
        <tr><td>systemd/encode-watcher.sh</td><td>скрипт наблюдения и вызова encode.sh</td></tr>
        <tr><td>bin/encode.sh</td><td>пример перекодировщика на базе ffmpeg</td></tr>
        <tr><td>bin/backup-recordings.sh</td><td>rsync бэкап на NAS</td></tr>
        <tr><td>windows/backup-recordings.bat</td><td>robocopy бэкап для Windows ноутбука</td></tr>
        <tr><td>windows/health-check.bat</td><td>пример health check на Windows</td></tr>
        <tr><td>README.txt</td><td>инструкции по установке и настройке</td></tr>
      </tbody>
    </table>
  </div>
</section>

<section id="email">
  <h2>Email-уведомления и автоматические отчёты</h2>
  <div class="node">
    <h3>Шаблон короткого email при падении сервиса</h3>
    <pre>To: ops@yourstudio.example
Subject: [ALERT] Studio service failure — {ZONE} — {SHORT_DESC}
Body:
Время: {TIMESTAMP}
Зона: {ZONE} (Laptop / CPU / GPU)
Короткое описание: {SHORT_DESC}
Действия выполнены: {ACTIONS}
Логи: {LOGFILE_PATH}
Файлы: {FILEPATHS}
Checksum (sha256): {SHA256}
-- 
Этот email сгенерирован автоматически. Проверь и открой инцидент в трекере.</pre>
    <p class="small">Генерация email — простая: health-check script может вызывать <kbd class="kbd">sendmail</kbd> на Linux или PowerShell's <kbd class="kbd">Send-MailMessage</kbd> на Windows, либо использовать SMTP через curl/postfix.</p>
  </div>

  <div class="node">
    <h3>Пример автоматического отчёта (daily)</h3>
    <pre>Subject: [Report] Studio daily report — {DATE}
Body:
Total sessions: {COUNT}
Successful encodes: {ENC_OK}
Failed encodes: {ENC_FAIL}
Average GPU temp (24h): {GPU_TEMP}
Disk usage: {DISK_USAGE}
Important logs: {ERROR_SUMMARY}
Attached: combined_logs_{DATE}.json
</pre>
    <p class="small">Скрипт формирует combined JSON лог и прикрепляет к письму или кладёт на NAS.</p>
  </div>
</section>

<section id="readme">
  <h2>Инструкция по установке скриптов (README)</h2>
  <div class="node">
    <h3>Linux (CPU / GPU)</h3>
    <ol>
      <li>Распакуй архив на сервер: <kbd class="kbd">unzip studio_scripts_v2.2.zip -d /opt/studio_scripts</kbd></li>
      <li>Сделай скрипты исполняемыми: <kbd class="kbd">chmod +x /opt/studio_scripts/bin/*.sh</kbd></li>
      <li>Перемести systemd unit: <kbd class="kbd">sudo cp systemd/studio-encode.service /etc/systemd/system/</kbd></li>
      <li>Запусти сервис: <kbd class="kbd">sudo systemctl daemon-reload && sudo systemctl enable --now studio-encode</kbd></li>
      <li>Проверь логи: <kbd class="kbd">journalctl -u studio-encode -f</kbd></li>
    </ol>
  </div>

  <div class="node">
    <h3>Windows (Laptop)</h3>
    <ol>
      <li>Распакуй архив на ноутбук и положи .bat в <kbd class="kbd">C:\studio\bin\</kbd></li>
      <li>Создай задачу в Task Scheduler (schtasks) или через GUI, укажи расписание и действие (.bat).</li>
      <li>Проверь права доступа к NAS (mapped drive или UNC path) и запусти тестовый backup.</li>
    </ol>
  </div>
</section>

<footer>
  <p class="small">Архив и HTML находятся рядом — скачай zip, распакуй и следуй README. Если хочешь, я могу настроить конкретные строки для твоего провайдера (имя пользователя, пути, SMTP сервер) и сгенерировать финальную конфигурацию.</p>
</footer>
</body>
</html>
